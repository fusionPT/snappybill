function save_offline(){store.set("billable",{kind:$("#kind").val(),company_name:$("#company_name").val(),company_info:$("#company_info").val(),recipient_info:$("#recipient_info").val(),invoice_number_label:$("#invoice_number_label").val(),invoice_number:$("#invoice_number").val(),invoice_date_label:$("#invoice_date_label").val(),description_label:$("#description_label").val(),quantity_label:$("#quantity_label").val(),price_label:$("#price_label").val(),subtotal_label:$("#subtotal_label").val(),tax_name:$("#tax_name").val(),tax_percentage:$("#tax_percentage").val(),total_label:$("#total_label").val(),currency_symbol:$("#currency_symbol").val(),notes_a:$("#notes_a").val(),notes_b:$("#notes_b").val()});var e=new Array;$("#items tr").not("thead tr, tfoot tr").each(function(){e.push({description:$(this).find("textarea").val(),quantity:$(this).find("input").eq(0).val(),price:$(this).find("input").eq(1).val()})});store.set("billable_items",e)}(function(e){function t(t){var n;return t&&t.constructor==Array&&t.length==3?t:(n=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(t))?[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])]:(n=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(t))?[parseFloat(n[1])*2.55,parseFloat(n[2])*2.55,parseFloat(n[3])*2.55]:(n=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(t))?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:(n=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(t))?[parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)]:(n=/rgba\(0, 0, 0, 0\)/.exec(t))?r.transparent:r[e.trim(t).toLowerCase()]}function n(n,r){var i;do{i=e.curCSS(n,r);if(i!=""&&i!="transparent"||e.nodeName(n,"body"))break;r="backgroundColor"}while(n=n.parentNode);return t(i)}e.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(r,i){e.fx.step[i]=function(e){if(!e.colorInit){e.start=n(e.elem,i);e.end=t(e.end);e.colorInit=!0}e.elem.style[i]="rgb("+[Math.max(Math.min(parseInt(e.pos*(e.end[0]-e.start[0])+e.start[0]),255),0),Math.max(Math.min(parseInt(e.pos*(e.end[1]-e.start[1])+e.start[1]),255),0),Math.max(Math.min(parseInt(e.pos*(e.end[2]-e.start[2])+e.start[2]),255),0)].join(",")+")"}});var r={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]}})(jQuery);(function(e){e.fn.extend({elastic:function(){var t=["paddingTop","paddingRight","paddingBottom","paddingLeft","fontSize","lineHeight","fontFamily","width","fontWeight"];return this.each(function(){function f(e,t){curratedHeight=Math.floor(parseInt(e,10));n.height()!=curratedHeight&&n.css({height:curratedHeight+"px",overflow:t})}function l(){var e=n.val().replace(/&/g,"&amp;").replace(/  /g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />"),t=r.html();if(e+"&nbsp;"!=t){r.html(e+"&nbsp;");if(Math.abs(r.height()+i-n.height())>3){var u=r.height()+i;u>=o?f(o,"auto"):u<=s?f(s,"hidden"):f(u,"hidden")}}}if(this.type!="textarea")return!1;var n=e(this),r=e("<div />").css({position:"absolute",display:"none","word-wrap":"break-word"}),i=parseInt(n.css("line-height"),10)||parseInt(n.css("font-size"),"10"),s=parseInt(n.css("height"),10)||i*3,o=parseInt(n.css("max-height"),10)||Number.MAX_VALUE,u=0,a=0;o<0&&(o=Number.MAX_VALUE);r.appendTo(n.parent());var a=t.length;while(a--)r.css(t[a].toString(),n.css(t[a].toString()));n.css({overflow:"hidden"});n.keyup(function(){l()});n.live("input paste",function(e){setTimeout(l,250)});l()})}})})(jQuery);var store=function(){function o(e){return JSON.stringify(e)}function u(e){return typeof e!="string"?undefined:JSON.parse(e)}var e={},t=window,n=t.document,r="localStorage",i="globalStorage",s;e.set=function(e,t){};e.get=function(e){};e.remove=function(e){};e.clear=function(){};e.transact=function(t,n){var r=e.get(t);typeof r=="undefined"&&(r={});n(r);store.set(t,r)};if(r in t&&t[r]){s=t[r];e.set=function(e,t){s.setItem(e,o(t))};e.get=function(e){return u(s.getItem(e))};e.remove=function(e){s.removeItem(e)};e.clear=function(){s.clear()}}else if(i in t&&t[i]){s=t[i][t.location.hostname];e.set=function(e,t){s[e]=o(t)};e.get=function(e){return u(s[e]&&s[e].value)};e.remove=function(e){delete s[e]};e.clear=function(){for(var e in s)delete s[e]}}else if(n.documentElement.addBehavior){var s=n.createElement("div");function a(t){return function(){var i=Array.prototype.slice.call(arguments,0);i.unshift(s);n.body.appendChild(s);s.addBehavior("#default#userData");s.load(r);var o=t.apply(e,i);n.body.removeChild(s);return o}}e.set=a(function(e,t,n){e.setAttribute(t,o(n));e.save(r)});e.get=a(function(e,t){return u(e.getAttribute(t))});e.remove=a(function(e,t){e.removeAttribute(t);e.save(r)});e.clear=a(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(r);for(var n=0,i;i=t[n];n++)e.removeAttribute(i.name);e.save(r)})}return e}(),sprintf=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}var n=function(){n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0]));return n.format.call(null,n.cache[arguments[0]],arguments)};n.format=function(n,r){var i=1,s=n.length,o="",u,a=[],f,l,c,h,p,d;for(f=0;f<s;f++){o=e(n[f]);if(o==="string")a.push(n[f]);else if(o==="array"){c=n[f];if(c[2]){u=r[i];for(l=0;l<c[2].length;l++){if(!u.hasOwnProperty(c[2][l]))throw sprintf('[sprintf] property "%s" does not exist',c[2][l]);u=u[c[2][l]]}}else c[1]?u=r[c[1]]:u=r[i++];if(/[^s]/.test(c[8])&&e(u)!="number")throw sprintf("[sprintf] expecting number but found %s",e(u));switch(c[8]){case"b":u=u.toString(2);break;case"c":u=String.fromCharCode(u);break;case"d":u=parseInt(u,10);break;case"e":u=c[7]?u.toExponential(c[7]):u.toExponential();break;case"f":u=c[7]?parseFloat(u).toFixed(c[7]):parseFloat(u);break;case"o":u=u.toString(8);break;case"s":u=(u=String(u))&&c[7]?u.substring(0,c[7]):u;break;case"u":u=Math.abs(u);break;case"x":u=u.toString(16);break;case"X":u=u.toString(16).toUpperCase()}u=/[def]/.test(c[8])&&c[3]&&u>=0?"+"+u:u;p=c[4]?c[4]=="0"?"0":c[4].charAt(1):" ";d=c[6]-String(u).length;h=c[6]?t(p,d):"";a.push(c[5]?u+h:h+u)}}return a.join("")};n.cache={};n.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw"[sprintf] huh?";if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw"[sprintf] huh?";s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw"[sprintf] huh?";s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";r.push(n)}t=t.substring(n[0].length)}return r};return n}(),vsprintf=function(e,t){t.unshift(e);return sprintf.apply(null,t)};$("a[href=#print]").live("click",function(){$("textarea, input").css("background","transparent");window.print();return!1});$("a[href=#pdf]").live("click",function(){var e=$("form");e.attr("action","/pdf/");e.submit();return!1});$("a[href=#save]").live("click",function(){var e=$(this);save_offline();e.text("Saving...");setTimeout(function(){e.text("Save")},300);return});$("#items tfoot a").live("click",function(){var e=$("#items textarea").length;$("#items tfoot").before('<tr><td class="action"></td><td class="description"><textarea name="items.'+e+'.description"></textarea></td>'+'<td class="quantity"><input type="text" name="items.'+e+'.quantity" value="1"></td>'+'<td class="price"><input type="text" name="items.'+e+'.price" value="00.00"></td>'+'<td class="action"><a href="#remove">[ x ]</a></td>'+"</tr>");$("#items tfoot").prev().find("textarea").elastic();return!1});$(".quantity input, .price input, #tax_percentage").live("keyup",function(){var e=$(this),t=e.val();if(isNaN(t))$(this).addClass("error").animate({backgroundColor:"#f9c6c7"},200);else{e.hasClass("error")&&e.removeClass("error").animate({backgroundColor:"#f9f3a7"},200);var n=0;$("#items tr").each(function(){var e=parseFloat($(this).find(".quantity input").val())*10,t=parseFloat($(this).find(".price input").val())*10;if(isNaN(e)||isNaN(t))return;n+=e*t});var t=sprintf("%.2f",n/100);$("span.subtotal").text(t);$("input.subtotal").val(t);var r=parseFloat($("#tax_percentage").val(),10)/100;if(isNaN(r))return;var i=r*n,t=sprintf("%.2f",i/100);$("span.tax_amount").text(t);$("input.tax_amount").val(t);var t=sprintf("%.2f",(n+i)/100);$("span.total").text(t);$("input.total").val(t)}});$('#items a[href="#remove"]').live("click",function(){var e=$(this).parent().parent();if(confirm("Remove this item?")){e.remove();$("#tax_percentage").keyup()}return!1});$(function(){$("input, textarea").attr("autocomplete","off");s=store.get("billable");s||(s={kind:"INVOICE",company_name:"Example Co.",company_info:"www.example.com\ninfo@example.com",recipient_info:"Michael Scott Paper Company Inc.\n1725 Slough Avenue\nScranton, Pennsylvania",invoice_number_label:"Invoice #",invoice_number:"1",invoice_date_label:"Date",description_label:"Item & Description",quantity_label:"Quantity",price_label:"Price",subtotal_label:"Subtotal",tax_name:"VAT",tax_percentage:"14",total_label:"Total",currency_symbol:"R",notes_a:"",notes_b:"\nCreated with Billable.me"});s.invoice_number_label==undefined&&(s.invoice_number_label="Invoice #");s.invoice_date_label==undefined&&(s.invoice_date_label="Date");s.description_label==undefined&&(s.description_label="Item & Description");s.quantity_label==undefined&&(s.quantity_label="Quantity");s.price_label==undefined&&(s.price_label="Price");s.subtotal_label==undefined&&(s.subtotal_label="Subtotal");s.total_label==undefined&&(s.total_label="Total");$("#kind").val(s.kind);$("#company_name").val(s.company_name);$("#company_info").val(s.company_info);$("#recipient_info").val(s.recipient_info);$("#invoice_number_label").val(s.invoice_number_label);$("#invoice_number").val(s.invoice_number);$("#description_label").val(s.description_label);$("#quantity_label").val(s.quantity_label);$("#price_label").val(s.price_label);$("#subtotal_label").val(s.subtotal_label);$("#tax_name").val(s.tax_name);$("#tax_percentage").val(s.tax_percentage);$("#total_label").val(s.total_label);$("#currency_symbol").val(s.currency_symbol);$("#notes_a").val(s.notes_a);$("#notes_b").val(s.notes_b);var e=new Date,t=new Array("January","February","March","April","May","June","July","August","September","October","November","December");$("#invoice_date_label").val(s.invoice_date_label);$("#invoice_date").val(e.getDate()+" "+t[e.getMonth()]+", "+e.getFullYear());var n=store.get("billable_items");n?$(n).each(function(e){$("#items tfoot a").click();var t=$("#items tr").eq(e+1),e=t.find("input");t.find("textarea").val(this.description);e.eq(0).val(this.quantity);e.eq(1).val(this.price);e.eq(1).keyup()}):$("#items tfoot a").click();$("textarea").elastic();$("input, textarea").live("focus",function(){$(this).animate({backgroundColor:"#f9f3a7"},200);$(this).addClass("focus")}).live("blur",function(){$(this).css("background","transparent");$(this).removeClass("focus")}).live("mouseenter",function(){$(this).hasClass("focus")||$(this).stop().animate({backgroundColor:"#f9f5c6"},200)}).live("mouseleave",function(){$(this).hasClass("focus")||$(this).stop().animate({backgroundColor:"#fafbfb"},200)});$(window).unload(function(){save_offline()})});